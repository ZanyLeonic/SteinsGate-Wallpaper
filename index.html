<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Steins;Gate</title>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script type="text/javascript" src="main.js"></script>
    </head>
    <body> 
        <div class="bg-components">
            <div id="bg-base" class="bg-base"></div>
            <div class="bg-comp01"></div>
            <div class="bg-comp02"></div>
            <div class="bg-comp03"></div>
            <div class="bg-comp04"></div>
            <div class="bg-comp05"></div>
            <div class="bg-comp06-container">
                <img class="bg-comp06" src="img/bg_comp06.png" />
            </div>
        </div>
        <video id="bg-video" class="video" muted loop>
            <source src="bg.webm" type="video/webm">
        </video>
        <audio id="bg-audio" hidden loop>
            <source src="bg.ogg" type="audio/ogg">
        </audio>
        
        <script type="text/javascript">
            var bgcomp01 = document.getElementsByClassName("bg-comp01")[0];
            var bgcomp02 = document.getElementsByClassName("bg-comp02")[0];
            var bgcomp03 = document.getElementsByClassName("bg-comp03")[0];
            var bgcomp04 = document.getElementsByClassName("bg-comp04")[0];
            var bgcomp05 = document.getElementsByClassName("bg-comp05")[0];
            var bgcomp06 = document.getElementsByClassName("bg-comp06")[0];

            var bgcomp = [bgcomp02, bgcomp03, bgcomp04];
            var lastElement = null;
            
            var wallpaperProperties = null;

            function setNewTiming(element, time)
            {
                element.style.setProperty("--" + element.className + "-timing", time + "s");
            }

            function changeAnimationTime(element)
            {
                var randomTiming = getRandomFloat(0.0001, 0.05);
                setNewTiming(element, randomTiming);
            }

            function randomVisibility()
            {
                if (lastElement != null)
                {
                    lastElement.style.display = "";
                }
                
                var randElement = bgcomp[getRandomInt(0, bgcomp.length)];

                randElement.style.display = "none";
                lastElement = randElement;
            }

            function comp06Anim()
            {
                switch (getRandomInt(0,3))
                {
                    case 0:
                        bgcomp06.style.clipPath = "polygon(0 0, 10.5% 0, 10.5% 100%, 0 100%)";
                        break;
                    case 1:
                        bgcomp06.style.clipPath = "polygon(0 0, 13% 0, 13% 100%, 0 100%)";
                        break;
                    case 2:
                        bgcomp06.style.clipPath = "";
                        break;
                }
            }

            setInterval(changeAnimationTime, getRandomInt(1000, 2500), bgcomp01);
            setInterval(changeAnimationTime, getRandomInt(1000, 2500), bgcomp02);
            setInterval(changeAnimationTime, getRandomInt(1000, 2500), bgcomp03);
            setInterval(changeAnimationTime, getRandomInt(1000, 2500), bgcomp04);
            setInterval(changeAnimationTime, getRandomInt(1000, 2500), bgcomp05);

            setInterval(randomVisibility, 2500);
            setInterval(comp06Anim, 1000);

            (function() {
                /**
                * Video element
                * @type {HTMLElement}
                */
                var video = document.getElementById("bg-video");

                /**
                * Audio element
                * @type {HTMLElement}
                */
                var audio = document.getElementById("bg-audio");
                
                /**
                * Check if video can play, and play it
                */
                video.addEventListener("canplay", function() {
                    video.play();
                });
                audio.addEventListener("canplay", function() {
                    audio.play();
                });
            })();

            window.wallpaperPropertyListener = {
                applyUserProperties: function(properties) {
                    /**
                    * Video element
                    * @type {HTMLElement}
                    */
                    var video = document.getElementById("bg-video");
                    if (properties.enableVideo && video)
                    {
                        if(properties.enableVideo.value == true)
                        {
                            video.play();
                        }
                        else
                        {
                            video.pause();
                        }
                    }

                    /**
                    * Audio element
                    * @type {HTMLElement}
                    */
                    var audio = document.getElementById("bg-audio");
                    if (properties.enableBGM && audio)
                    {
                        if(properties.enableBGM.value == true)
                        {
                            audio.play();
                        }
                        else
                        {
                            audio.pause();
                        }
                    }

                    if (properties.BGMVolume && audio)
                    {
                        if (properties.BGMVolume.value != "")
                        {
                            if (properties.BGMVolume.value == 0)
                            {
                                audio.volume = properties.BGMVolume.value = 0;
                            }
                            else
                            {
                                audio.volume = properties.BGMVolume.value / 100;
                            }
                        }
                    }

                    var base = document.getElementById("bg-base");

                    if (properties.showCopyrightInfo && base)
                    {
                        base.className = properties.showCopyrightInfo.value ? "bg-base-copyright" : "bg-base";
                    }
                }
            };
        </script>          
    </body>
</html>